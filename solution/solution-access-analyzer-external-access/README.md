# 通过访问分析识别和收敛外部访问

企业在日常用云的过程中，为保证业务的灵活性，通常会出现外部访问授权的情形，如账号A会将部分云资源授权给账号B乃至多个账号使用，运维团队对此难以及时跟踪，存在安全风险。为了既不影响业务协同的灵活性，又保障企业账号的安全，本方案介绍如何通过Access Analyzer访问分析服务来帮助企业及时发现存在跨账号访问权限的资源，从而判断该访问的合理性并收敛非必要的外部访问权限。

访问分析通过和事件总线集成，支持您使用事件总线接收访问分析的分析结果事件，并执行您自己的自动化程序，实现访问分析结果的自动修复和处理。这里针对最常见的OSS Bucket非预期公开访问的场景，通过访问分析、事件总线配合函数计算，实现自动化阻止OSS Bucket公开访问，避免非预期的公开访问，导致企业数据泄露，及时保证数据安全。

本方案提供基于Terraform的自动化模板，为资源目录下的目标账号批量创建RAM角色并提供函数计算示例代码。

## 使用步骤

### 自动化部署代码

本方案提供了基于ROS的批量跨账号创建角色的Terraform自动化代码，模版代码所在目录为`ros/create-role-cross-account`，其模版入参输入：

| **参数名称** | **参数值示例** | **描述** |
| --- | --- | --- |
| role_name | CentralizedOperationRole | 批量创建的角色的名称 |
| policy_name | CentralizedOperationRolePolicy | 绑定到该角色的权限策略的名称 |
| policy_document | {"Version":"1","Statement":[{"Action":"ecs:*","Resource":"*","Effect":"Allow"}]} | 绑定到该角色的权限策略内容。既跨账号资源操作的所有权限。|
| assume_role_principal_account | 1254004******** | 角色的可信账号，既允许扮演到该新建角色的账号，不填默认为当前账号|
| assume_role_principal_role | AssumeRoleName | 允许可信账号下扮演到该角色的角色名称。请确保该角色在可信账号下已经存在，否则会创建失败。 |

### 函数计算代码示例

本方案提供了基于函数计算自动阻止OSS Bucket公共访问的示例代码，代码所在目录为`fc/java`。您可以使用命令`mvn -U clean package`将代码构建为JAR包，然后上传至阿里云函数计算。